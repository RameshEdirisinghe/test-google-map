<!DOCTYPE html>
<html>
<head>
  <title>My First Google Map</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=*************************"></script>
  <script>
    let map;
    let marker;
    let currentLocation;

    function initMap() {
      const defaultLocation = { lat: 6.9271, lng: 79.8612 }; // fallback
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 10,
        center: defaultLocation
      });

      marker = new google.maps.Marker({
        position: defaultLocation,
        map: map
      });

      getCurrentLocation();
    }

    function getCurrentLocation() {
      const statusEl = document.getElementById("status");
      statusEl.textContent = "Getting your current location...";

      if (!navigator.geolocation) {
        statusEl.textContent = "Geolocation is not supported by your browser.";
        return;
      }

      navigator.geolocation.getCurrentPosition(
        function (position) {
          currentLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };

          map.setCenter(currentLocation);
          map.setZoom(15);
          marker.setPosition(currentLocation);
          statusEl.textContent = `Current location: ${currentLocation.lat.toFixed(6)}, ${currentLocation.lng.toFixed(6)}`;
        },
        function (error) {
          statusEl.textContent = "Unable to get your location. Please allow location access.";
          console.error("Geolocation error:", error);
        }
      );
    }

    async function shareLocation() {
      const statusEl = document.getElementById("status");

      if (!currentLocation) {
        statusEl.textContent = "Location is not ready yet. Try again in a moment.";
        return;
      }

      const locationUrl = `https://www.google.com/maps?q=${currentLocation.lat},${currentLocation.lng}`;
      const shareData = {
        title: "My Current Location",
        text: "Here is my current location:",
        url: locationUrl
      };

      try {
        if (navigator.share) {
          await navigator.share(shareData);
          statusEl.textContent = "Location shared successfully.";
        } else if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(locationUrl);
          statusEl.textContent = "Share not supported. Location link copied to clipboard.";
        } else {
          statusEl.textContent = "Sharing is not supported on this browser.";
        }
      } catch (err) {
        statusEl.textContent = "Sharing was canceled or failed.";
        console.error("Share error:", err);
      }
    }
  </script>
</head>
<body onload="initMap()">
  <h2>My Google Map</h2>
  <button type="button" onclick="shareLocation()">Share Location</button>
  <p id="status">Waiting for location...</p>
  <div id="map" style="height:500px;width:100%;"></div>
</body>
</html>
